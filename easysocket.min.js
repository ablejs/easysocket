"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var n=function(n){for(var o in n)this.conf[o]=n[o];return"WebSocket"in e?console.log("Your browser support WebSocket!"):console.log("Your browser doesn't support WebSocket!"),EasySocketConn=this,setInterval(this.sendHeart,1e3*this.conf.heartSleep),this};n.prototype={version:"0.0.2",conf:{url:"",heart:"heart",heartSleep:60,reconn:!0,eventKey:"cmd",debug:!1},socket:null,createTime:0,reConnData:[],listener:{},ajaxQueue:{},event:{open:null,close:null},init:function(e){this.event.open=e,console.log("Websocket Connecting: "+this.conf.url);var n=new WebSocket(this.conf.url);this.socket=n,n.onopen=this.onOpen,n.onmessage=this.onMessage,n.onclose=this.onClose},addListener:function(e,n){this.listener[e]=n},send:function(e,n){"object"==(void 0===e?"undefined":_typeof(e))&&(e=JSON.stringify(e)),n&&this.reConnData.push(e),this.socket.send(e)},ajax:function(e,n){var o="Es"+(new Date).valueOf()+String(Math.ceil(1e3*Math.random())),t={sessId:o,data:e.data};t[this.conf.eventKey]=e[this.conf.eventKey],this.send(t),this.ajaxQueue[o]=n,e.outtime&&setTimeout(function(){var e=EasySocketConn;e.ajaxQueue[o]&&(e.ajaxQueue[o](null,{code:1,msg:"Response timeout."}),delete e.ajaxQueue[o])},1e3*e.outtime)},sendHeart:function(){var e=EasySocketConn;if(null!==e.socket)if("function"==typeof e.conf.heart.data){var n={};for(var o in e.conf.heart)n[o]=e.conf.heart[o];n.data=e.conf.heart.data(),e.send(n)}else e.send(e.conf.heart)},onOpen:function(){var e=EasySocketConn;console.log("Websocket Connected.");for(var n in e.reConnData)e.send(e.reConnData[n]);"function"==typeof e.event.open&&(e.event.open(),e.event.open=null)},onMessage:function(e){var n=EasySocketConn,o=n.deJson(e.data);return!1===o?void(n.conf.debug&&console.log("Websocket Raw Dataï¼š"+e.data)):o.sessId&&n.ajaxQueue[o.sessId]?(n.ajaxQueue[o.sessId](o),void delete n.ajaxQueue[o.sessId]):void(o[n.conf.eventKey]&&n.listener[o[n.conf.eventKey]]&&n.listener[o[n.conf.eventKey]](o))},onClose:function(){var e=EasySocketConn;e.socket=null,"function"==typeof e.event.close&&e.event.close(),e.conf.reconn&&(e.conf.debug&&console.log("Websocket Disconnected, reconnecting..."),setTimeout(e.init(),1e3))},deJson:function(e){if("string"==typeof e)try{var n=JSON.parse(e);if("object"==(void 0===n?"undefined":_typeof(n))&&n)return n}catch(e){return!1}return!1}},e.EasySocket=n,e.EasySocketConn=null}(window);
